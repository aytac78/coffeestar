<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Coffee Star ‚Äì Deƒüerlendirme & √úyelik MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f1e8;
      --card: #ffffff;
      --accent: #c27b41;
      --accent-dark: #8a4d24;
      --accent-soft: #f3d3a1;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --danger: #dc2626;
      --success: #16a34a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(227, 171, 93, 0.18), transparent 45%),
        radial-gradient(circle at bottom right, rgba(90, 56, 32, 0.18), transparent 45%),
        var(--bg);
      color: var(--text-main);
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(247,241,232,0.92);
      border-bottom: 1px solid rgba(229,231,235,0.7);
    }
    .header-inner {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0.7rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 25% 20%, #fdf2d8, transparent 55%),
        radial-gradient(circle at 75% 80%, #5b3319, #2b150a);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fef3c7;
      font-weight: 900;
      font-size: 0.95rem;
      box-shadow: 0 8px 18px rgba(15,23,42,0.28);
      position: relative;
      overflow: hidden;
    }
    .brand-logo::before {
      content: "";
      position: absolute;
      width: 130%;
      height: 130%;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(0,0,0,0.14) 0, transparent 45%),
        radial-gradient(circle at 70% 70%, rgba(0,0,0,0.22) 0, transparent 55%);
      mix-blend-mode: multiply;
      opacity: 0.85;
    }
    .brand-logo span {
      position: relative;
      z-index: 2;
      letter-spacing: 0.04em;
    }
    .brand-text-title {
      font-weight: 800;
      letter-spacing: 0.08em;
      font-size: 0.95rem;
      text-transform: uppercase;
    }
    .brand-text-sub {
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .mode-toggle {
      display: inline-flex;
      padding: 0.2rem;
      background: #fff;
      border-radius: 999px;
      border: 1px solid rgba(229,231,235,0.9);
      box-shadow: 0 4px 12px rgba(15,23,42,0.12);
    }
    .mode-btn {
      border: none;
      background: transparent;
      border-radius: 999px;
      padding: 0.45rem 1rem;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--text-muted);
    }
    .mode-btn span.icon {
      font-size: 1.05rem;
    }
    .mode-btn.active {
      background: linear-gradient(135deg, #c27b41, #5b3319);
      color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
    }

    main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 1rem;
      padding-bottom: 3rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 750;
      margin-bottom: 0.15rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .section-title::after {
      content: "";
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, rgba(194,123,65,0.45), transparent);
      max-width: 160px;
    }
    .section-sub {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .card {
      background: var(--card);
      border-radius: 1.2rem;
      border: 1px solid rgba(229,231,235,0.95);
      box-shadow: 0 16px 40px rgba(15,23,42,0.08);
      padding: 1rem;
    }

    .shop-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 0.9rem;
    }
    .shop-card {
      border-radius: 1rem;
      border: 1px solid var(--border);
      padding: 0.9rem;
      background:
        radial-gradient(circle at top left, rgba(244,220,186,0.9), transparent 50%),
        linear-gradient(145deg,#ffffff,#fdf8f3);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      position: relative;
      overflow: hidden;
    }
    .shop-card::before {
      content: "";
      position: absolute;
      width: 80px;
      height: 80px;
      right: -20px;
      bottom: -20px;
      border-radius: 50% 50% 10% 50%;
      background: radial-gradient(circle at 30% 30%, #4b2712, #1f0f07);
      opacity: 0.12;
    }
    .shop-tag {
      position: absolute;
      top: 0.6rem;
      right: 0.6rem;
      background: rgba(24,24,27,0.82);
      color: #fff;
      font-size: 0.7rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
    }
    .shop-name {
      font-weight: 720;
      font-size: 1rem;
      margin-bottom: 0.1rem;
    }
    .shop-location {
      font-size: 0.78rem;
      color: var(--text-muted);
    }
    .shop-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }
    .pill {
      font-size: 0.7rem;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      background: rgba(249,250,251,0.9);
    }
    .rating-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.78rem;
      padding: 0.1rem 0.6rem;
      border-radius: 999px;
      background: rgba(234,179,8,0.12);
      color: #92400e;
    }
    .shop-actions {
      margin-top: 0.5rem;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .btn {
      border-radius: 999px;
      border: none;
      font-size: 0.78rem;
      padding: 0.35rem 0.7rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      justify-content: center;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg,#c27b41,#5b3319);
      color: #fff;
      box-shadow: 0 3px 10px rgba(0,0,0,0.16);
    }
    .btn-outline {
      background: #fff;
      color: var(--text-main);
      border: 1px solid var(--border);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.3rem;
    }
    .chip {
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      font-size: 0.7rem;
      padding: 0.1rem 0.5rem;
      background: rgba(243,244,246,0.9);
    }

    .badge {
      font-size: 0.7rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
    }
    .badge-star {
      background: rgba(234,179,8,0.14);
      color: #92400e;
    }
    .badge-wifi {
      background: rgba(59,130,246,0.1);
      color: #1d4ed8;
    }
    .badge-laptop {
      background: rgba(34,197,94,0.11);
      color: #15803d;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      z-index: 20;
    }
    .modal {
      background: #fff;
      border-radius: 1.2rem;
      max-width: 480px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 20px 60px rgba(15,23,42,0.4);
      padding: 1rem 1.1rem 1.25rem;
      animation: pop 0.2s ease-out;
    }
    @keyframes pop {
      from { transform: translateY(10px) scale(0.96); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }

    .form-group {
      margin-bottom: 0.55rem;
    }
    label {
      display: block;
      font-size: 0.78rem;
      margin-bottom: 0.18rem;
      color: var(--text-main);
    }
    input[type="text"],
    input[type="tel"],
    input[type="email"],
    textarea,
    select {
      width: 100%;
      border-radius: 0.7rem;
      border: 1px solid var(--border);
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
      font-family: inherit;
    }
    textarea { resize: vertical; min-height: 70px; }

    .alert {
      font-size: 0.76rem;
      padding: 0.4rem 0.6rem;
      border-radius: 0.6rem;
      margin-top: 0.2rem;
    }
    .alert-success {
      background: rgba(22,163,74,0.06);
      color: #166534;
      border: 1    px solid rgba(22,163,74,0.2);
    }
    .alert-error {
      background: rgba(220,38,38,0.06);
      color: #b91c1c;
      border: 1px solid rgba(220,38,38,0.25);
    }

    .business-layout {
      display: grid;
      gap: 1rem;
    }
    @media (min-width: 800px) {
      .business-layout {
        grid-template-columns: 1.3fr 1fr;
        align-items: flex-start;
      }
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-top: 0.15rem;
    }
    .stat-label {
      color: var(--text-muted);
    }
    .stat-value {
      font-weight: 600;
    }

    .badge-status {
      font-size: 0.7rem;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      background: rgba(59,130,246,0.1);
      color: #1d4ed8;
    }

    footer {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1rem 1rem;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .link {
      color: var(--accent-dark);
      text-decoration: underline;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="brand-logo">
          <span>CS</span>
        </div>
        <div>
          <div class="brand-text-title">Coffee Star</div>
          <div class="brand-text-sub">T√ºrkiye & Balkanlar i√ßin kahve mek√¢nƒ± puanlama</div>
        </div>
      </div>
      <div class="mode-toggle">
        <button class="mode-btn active" data-mode="customer">
          <span class="icon">üë§</span>
          <span>M√º≈üteri</span>
        </button>
        <button class="mode-btn" data-mode="business">
          <span class="icon">üè™</span>
          <span>ƒ∞≈ületme</span>
        </button>
      </div>
    </div>
  </header>

  <main>
    <section id="customer-section">
      <div class="section-title">Yakƒ±ndaki Coffee Star mek√¢nlarƒ±nƒ± ke≈üfet</div>
      <div class="section-sub">
        Coffee Star ile T√ºrkiye‚Äôdeki kahve barlarƒ±nƒ± ve kafeleri puanla, yorum bƒ±rak, favorilerini olu≈ütur.
        ƒ∞kinci a≈üamada Balkan √ºlkeleri sisteme eklenecek. Bu MVP s√ºr√ºm√º tamamen tarayƒ±cƒ±nda √ßalƒ±≈üƒ±r
        (veriler sadece bu cihazda saklanƒ±r).
      </div>

      <div class="card" style="margin-bottom:0.9rem;">
        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;justify-content:space-between;">
          <div style="font-size:0.8rem;color:var(--text-muted);">
            Filtrele:
          </div>
          <div style="display:flex;flex-wrap:wrap;gap:0.3rem;">
            <button class="btn btn-outline" data-filter="all">T√ºm√º</button>
            <button class="btn btn-outline" data-filter="thirdwave">3. dalga</button>
            <button class="btn btn-outline" data-filter="work">Laptop ile √ßalƒ±≈ümaya uygun</button>
            <button class="btn btn-outline" data-filter="wifi">G√º√ßl√º Wi-Fi</button>
          </div>
        </div>
      </div>

      <div class="shop-list" id="shop-list"></div>
    </section>

    <section id="business-section" style="display:none;">
      <div class="section-title">Coffee Star i≈ületme √ºyeliƒüi</div>
      <div class="section-sub">
        Coffee Star aƒüƒ±na katƒ±lƒ±n, mek√¢nƒ±nƒ±z kahve severler tarafƒ±ndan puanlansƒ±n. ƒ∞lk fazda T√ºrkiye,
        ikinci fazda Balkan √ºlkeleri hedeflenmektedir. Bu s√ºr√ºm demo ama√ßlƒ±dƒ±r, t√ºm veriler cihazƒ±nƒ±zda saklanƒ±r.
      </div>

      <div class="business-layout">
        <div class="card">
          <h3 style="font-size:0.95rem;font-weight:700;margin:0 0 0.6rem;">√úyelik ba≈üvuru formu</h3>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:0.6rem;">
            Yƒ±llƒ±k yakla≈üƒ±k <strong>$20</strong> √ºyelik √ºcreti ile Coffee Star sistemine katƒ±lƒ±m.
            Ger√ßek fiyatlandƒ±rma, s√∂zle≈üme ve √∂deme altyapƒ±sƒ± ana ekosistemde y√∂netilecektir; bu ekran i≈ületme tarafƒ±
            i√ßin demo i≈ü akƒ±≈üƒ±nƒ± g√∂sterir.
          </div>
          <form id="membership-form">
            <div class="form-group">
              <label>ƒ∞≈ületme adƒ± *</label>
              <input type="text" name="shop_name" required />
            </div>
            <div class="form-group">
              <label>Yetkili ki≈üi</label>
              <input type="text" name="contact_name" />
            </div>
            <div class="form-group">
              <label>Telefon</label>
              <input type="tel" name="phone" />
            </div>
            <div class="form-group">
              <label>E-posta</label>
              <input type="email" name="email" />
            </div>
            <div class="form-group" style="display:flex;gap:0.4rem;">
              <div style="flex:1;">
                <label>≈ûehir</label>
                <input type="text" name="city" />
              </div>
              <div style="flex:1;">
                <label>√úlke</label>
                <input type="text" name="country" value="T√ºrkiye" />
              </div>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" name="has_third_wave" checked />
                3. dalga / √∂zel kahve konseptine yakƒ±nƒ±z
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" name="wants_coffee_star" checked />
                Coffee Star derecelendirmesine ba≈üvurmak istiyoruz
              </label>
            </div>
            <div class="form-group">
              <label>Notlar (ekipman, kavurucu, konsept, √ßalƒ±≈üma saatleri vb.)</label>
              <textarea name="notes"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%;margin-top:0.3rem;">Ba≈üvuruyu kaydet</button>
            <div id="membership-message" style="margin-top:0.4rem;"></div>
          </form>
        </div>

        <div class="card">
          <h3 style="font-size:0.95rem;font-weight:700;margin-top:0;margin-bottom:0.6rem;">Ba≈üvurularƒ±nƒ±z</h3>
          <div id="membership-list" style="font-size:0.8rem;"></div>
        </div>
      </div>
    </section>
  </main>

  <div id="modal-root"></div>

  <footer>
    Coffee Star MVP ‚Äì t√ºm veriler sadece bu cihazda <strong>localStorage</strong> i√ßinde tutulur.
    Bir sonraki a≈üamada bu yapƒ±, senin ekosistemindeki ana veritabanƒ±na baƒülanacak ve T√ºrkiye + Balkan √ºlkeleri
    i√ßin √ßok kullanƒ±cƒ±lƒ± hale getirilecektir.
  </footer>

  <script>
    const STORAGE_KEY_SHOPS = "coffeeStar.shops.v1";
    const STORAGE_KEY_REVIEWS = "coffeeStar.reviews.v1";
    const STORAGE_KEY_MEMBERSHIPS = "coffeeStar.memberships.v1";

    const defaultShops = [
      {
        id: 1,
        name: "Third Wave Lab",
        city: "ƒ∞stanbul",
        district: "Moda",
        thirdWave: true,
        wifi: true,
        workFriendly: true,
        priceLevel: "‚Ç∫‚Ç∫",
        beans: "Tek k√∂ken, light roast",
        methods: ["V60", "Chemex", "Aeropress"],
        tags: ["3. dalga", "Specialty", "Slow coffee", "T√ºrkiye"]
      },
      {
        id: 2,
        name: "Roaster's Corner",
        city: "ƒ∞stanbul",
        district: "Karak√∂y",
        thirdWave: true,
        wifi: true,
        workFriendly: false,
        priceLevel: "‚Ç∫‚Ç∫‚Ç∫",
        beans: "Kendi kavurumu, micro lot",
        methods: ["Espresso", "V60", "Cold Brew"],
        tags: ["Mikro kavurucu", "Espresso bar", "T√ºrkiye"]
      },
      {
        id: 3,
        name: "Daily Grind",
        city: "Ankara",
        district: "Tunus",
        thirdWave: false,
        wifi: true,
        workFriendly: true,
        priceLevel: "‚Ç∫",
        beans: "Blend",
        methods: ["Espresso", "Filtre kahve"],
        tags: ["√áalƒ±≈üma dostu", "Uygun fiyat", "T√ºrkiye"]
      },
      {
        id: 4,
        name: "Seaside Brew",
        city: "Bodrum",
        district: "Yalƒ±kavak",
        thirdWave: true,
        wifi: true,
        workFriendly: true,
        priceLevel: "‚Ç∫‚Ç∫‚Ç∫",
        beans: "Specialty, washed & natural",
        methods: ["Espresso", "V60", "Syphon"],
        tags: ["Deniz manzaralƒ±", "G√ºn batƒ±mƒ±", "3. dalga", "T√ºrkiye"]
      }
    ];

    function loadLocal(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch (e) {
        console.warn("localStorage parse error", key, e);
        return fallback;
      }
    }

    function saveLocal(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.warn("localStorage save error", key, e);
      }
    }

    let shops = loadLocal(STORAGE_KEY_SHOPS, defaultShops);
    let reviews = loadLocal(STORAGE_KEY_REVIEWS, []);
    let memberships = loadLocal(STORAGE_KEY_MEMBERSHIPS, []);

    let currentFilter = "all";

    function computeAverageRating(shopId) {
      const rs = reviews.filter(r => r.shopId === shopId);
      if (rs.length === 0) return null;
      const avg = rs.reduce((sum, r) => sum + r.rating, 0) / rs.length;
      return { avg, count: rs.length };
    }

    function renderShops() {
      const container = document.getElementById("shop-list");
      container.innerHTML = "";

      let filtered = shops;
      if (currentFilter === "thirdwave") {
        filtered = shops.filter(s => s.thirdWave);
      } else if (currentFilter === "work") {
        filtered = shops.filter(s => s.workFriendly);
      } else if (currentFilter === "wifi") {
        filtered = shops.filter(s => s.wifi);
      }

      if (filtered.length === 0) {
        container.innerHTML = '<div style="font-size:0.85rem;color:var(--text-muted);">Filtreye uyan mek√¢n bulunamadƒ±.</div>';
        return;
      }

      filtered.forEach(shop => {
        const ratingInfo = computeAverageRating(shop.id);
        const div = document.createElement("div");
        div.className = "shop-card";

        const badges = [];
        if (shop.thirdWave) {
          badges.push('<span class="badge badge-star">3. dalga</span>');
        }
        if (shop.wifi) {
          badges.push('<span class="badge badge-wifi">Wi-Fi</span>');
        }
        if (shop.workFriendly) {
          badges.push('<span class="badge badge-laptop">Laptop ile √ßalƒ±≈üma</span>');
        }

        const ratingHtml = ratingInfo
          ? `\<span class="rating-pill">‚≠ê ${ratingInfo.avg.toFixed(1)} ¬∑ ${ratingInfo.count} oy\</span>`
          : '<span class="rating-pill">Hen√ºz oy yok</span>';

        div.innerHTML = `
          <div class="shop-tag">${shop.priceLevel}</div>
          <div class="shop-name">${shop.name}</div>
          <div class="shop-location">${shop.city} ¬∑ ${shop.district}</div>
          <div class="shop-row">
            <div>${ratingHtml}</div>
          </div>
          <div class="chips">${badges.join("")}</div>
          <div class="shop-row" style="margin-top:0.4rem;">
            <div class="pill">${shop.beans}</div>
          </div>
          <div class="chips">
            ${shop.methods.map(m => `<span class="chip">${m}</span>`).join("")}
          </div>
          <div class="shop-actions">
            <button class="btn btn-primary" data-action="rate" data-id="${shop.id}">
              Deƒüerlendir
            </button>
            <button class="btn btn-outline" data-action="details" data-id="${shop.id}">
              Detay
            </button>
          </div>
        `;

        container.appendChild(div);
      });
    }

    function openModal(contentHtml) {
      const root = document.getElementById("modal-root");
      root.innerHTML = "";
      const backdrop = document.createElement("div");
      backdrop.className = "modal-backdrop";
      backdrop.innerHTML = '<div class="modal">' + contentHtml + "</div>";
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) {
          root.innerHTML = "";
        }
      });
      root.appendChild(backdrop);
    }

    function closeModal() {
      const root = document.getElementById("modal-root");
      root.innerHTML = "";
    }

    function openRateModal(shopId) {
      const shop = shops.find(s => s.id === shopId);
      if (!shop) return;

      const ratingInfo = computeAverageRating(shop.id);
      const ratingText = ratingInfo
        ? `≈ûu an ortalama: ${ratingInfo.avg.toFixed(1)} / 5 (${ratingInfo.count} oy)`
        : "Hen√ºz oy yok, ilk sen deƒüerlendir.";

      const html = `
        <h2 style="margin-top:0;font-size:1rem;font-weight:700;">${shop.name} i√ßin puan ver</h2>
        <div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:0.6rem;">${ratingText}</div>
        <form id="rate-form">
          <div class="form-group">
            <label>Puan (1‚Äì5)</label>
            <select name="rating">
              <option value="5">5 ‚Äì M√ºkemmel</option>
              <option value="4">4 ‚Äì √áok iyi</option>
              <option value="3">3 ‚Äì Ortalama</option>
              <option value="2">2 ‚Äì Zayƒ±f</option>
              <option value="1">1 ‚Äì K√∂t√º</option>
            </select>
          </div>
          <div class="form-group">
            <label>Yorum (opsiyonel)</label>
            <textarea name="comment" placeholder="Kahve kalitesi, ortam, m√ºzik, servis..."></textarea>
          </div>
          <button type="submit" class="btn btn-primary" style="width:100%;margin-top:0.3rem;">Kaydet</button>
          <button type="button" class="btn btn-outline" style="width:100%;margin-top:0.3rem;" data-close="1">Vazge√ß</button>
          <div id="rate-message" style="margin-top:0.4rem;"></div>
        </form>
      `;

      openModal(html);

      const form = document.getElementById("rate-form");
      const msgBox = document.getElementById("rate-message");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const rating = parseInt(formData.get("rating") || "5", 10);
        const comment = (formData.get("comment") || "").toString().trim();

        reviews.push({
          id: Date.now(),
          shopId: shop.id,
          rating,
          comment,
          createdAt: new Date().toISOString()
        });
        saveLocal(STORAGE_KEY_REVIEWS, reviews);

        msgBox.innerHTML = '<div class="alert alert-success">Deƒüerlendirmen kaydedildi. Te≈üekk√ºrler! ‚òï</div>';
        renderShops();
        setTimeout(closeModal, 900);
      });

      form.querySelectorAll("[data-close]").forEach(btn => {
        btn.addEventListener("click", closeModal);
      });
    }

    function openDetailsModal(shopId) {
      const shop = shops.find(s => s.id === shopId);
      if (!shop) return;
      const rs = reviews.filter(r => r.shopId === shop.id).sort((a, b) => (a.createdAt < b.createdAt ? 1 : -1));
      const ratingInfo = computeAverageRating(shop.id);

      const ratingHeader = ratingInfo
        ? `<div class="rating-pill" style="margin-top:0.2rem;">‚≠ê ${ratingInfo.avg.toFixed(1)} ¬∑ ${ratingInfo.count} oy</div>`
        : '<div class="rating-pill" style="margin-top:0.2rem;">Hen√ºz oy yok</div>';

      const reviewHtml = rs.length === 0
        ? '<div style="font-size:0.8rem;color:var(--text-muted);">Hen√ºz yorum yok.</div>'
        : rs.map(r => `
            <div style="border-top:1px dashed var(--border);padding-top:0.4rem;margin-top:0.4rem;font-size:0.8rem;">
              <div style="font-weight:600;">‚≠ê ${r.rating} / 5</div>
              ${r.comment ? '<div style="margin-top:0.1rem;">' + r.comment.replace(/</g,"&lt;") + '</div>' : ''}
              <div style="font-size:0.7rem;color:var(--text-muted);margin-top:0.1rem;">
                ${new Date(r.createdAt).toLocaleString("tr-TR")}
              </div>
            </div>
          `).join("");

      const html = `
        <h2 style="margin-top:0;font-size:1rem;font-weight:700;">${shop.name}</h2>
        <div style="font-size:0.8rem;color:var(--text-muted);">${shop.city} ¬∑ ${shop.district}</div>
        ${ratingHeader}
        <div style="margin-top:0.6rem;font-size:0.8rem;">
          <div><strong>√áekirdek:</strong> ${shop.beans}</div>
          <div style="margin-top:0.2rem;"><strong>Demleme y√∂ntemleri:</strong></div>
          <div class="chips" style="margin-top:0.25rem;">
            ${shop.methods.map(m => `<span class="chip">${m}</span>`).join("")}
          </div>
          ${shop.tags && shop.tags.length ? '<div style="margin-top:0.4rem;"><strong>√ñne √ßƒ±kanlar:</strong></div>' : ''}
          ${shop.tags && shop.tags.length ? '<div class="chips" style="margin-top:0.25rem;">' + shop.tags.map(t => '<span class="chip">'+t+'</span>').join('') + '</div>' : ''}
        </div>

        <div style="margin-top:0.8rem;">
          <h3 style="font-size:0.9rem;font-weight:700;margin:0 0 0.3rem;">Yorumlar</h3>
          ${reviewHtml}
        </div>

        <div style="margin-top:0.9rem;display:flex;gap:0.4rem;">
          <button class="btn btn-primary" data-action="rate-now" style="flex:1;">Bu mek√¢nƒ± deƒüerlendir</button>
          <button class="btn btn-outline" data-close="1" style="flex:1;">Kapat</button>
        </div>
      `;

      openModal(html);

      const modal = document.querySelector(".modal");
      modal.querySelectorAll("[data-close]").forEach(btn => {
        btn.addEventListener("click", closeModal);
      });
      const rateBtn = modal.querySelector('[data-action="rate-now"]');
      if (rateBtn) {
        rateBtn.addEventListener("click", () => {
          openRateModal(shop.id);
        });
      }
    }

    document.getElementById("shop-list").addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const action = btn.getAttribute("data-action");
      const id = parseInt(btn.getAttribute("data-id"), 10);
      if (action === "rate") {
        openRateModal(id);
      } else if (action === "details") {
        openDetailsModal(id);
      }
    });

    document.querySelectorAll("[data-filter]").forEach(btn => {
      btn.addEventListener("click", () => {
        currentFilter = btn.getAttribute("data-filter");
        document.querySelectorAll("[data-filter]").forEach(b => {
          b.classList.toggle("btn-primary", b === btn);
          b.classList.toggle("btn-outline", b !== btn);
        });
        renderShops();
      });
    });

    const modeButtons = document.querySelectorAll(".mode-btn");
    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const mode = btn.getAttribute("data-mode");
        modeButtons.forEach(b => b.classList.toggle("active", b === btn));
        document.getElementById("customer-section").style.display = mode === "customer" ? "" : "none";
        document.getElementById("business-section").style.display = mode === "business" ? "" : "none";
      });
    });

    const membershipForm = document.getElementById("membership-form");
    const membershipMessage = document.getElementById("membership-message");
    const membershipList = document.getElementById("membership-list");

    membershipForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const formData = new FormData(membershipForm);
      const entry = {
        id: Date.now(),
        shop_name: (formData.get("shop_name") || "").toString().trim(),
        contact_name: (formData.get("contact_name") || "").toString().trim(),
        phone: (formData.get("phone") || "").toString().trim(),
        email: (formData.get("email") || "").toString().trim(),
        city: (formData.get("city") || "").toString().trim(),
        country: (formData.get("country") || "").toString().trim(),
        has_third_wave: !!formData.get("has_third_wave"),
        wants_coffee_star: !!formData.get("wants_coffee_star"),
        notes: (formData.get("notes") || "").toString().trim(),
        status: "Taslak",
        createdAt: new Date().toISOString()
      };

      if (!entry.shop_name) {
        membershipMessage.innerHTML = '<div class="alert alert-error">ƒ∞≈ületme adƒ± zorunludur.</div>';
        return;
      }

      memberships.push(entry);
      saveLocal(STORAGE_KEY_MEMBERSHIPS, memberships);
      membershipForm.reset();
      membershipMessage.innerHTML = '<div class="alert alert-success">Ba≈üvurunuz bu cihazda kayƒ±t altƒ±na alƒ±ndƒ±. Ana sistemde ger√ßek ba≈üvuru API\'si ile entegre edilebilir.</div>';
      renderMemberships();
    });

    function renderMemberships() {
      membershipList.innerHTML = "";
      if (memberships.length === 0) {
        membershipList.innerHTML = '<div style="color:var(--text-muted);">Hen√ºz kayƒ±tlƒ± bir ba≈üvurunuz yok.</div>';
        return;
      }
      memberships
        .slice()
        .sort((a,b) => (a.createdAt < b.createdAt ? 1 : -1))
        .forEach(m => {
          const div = document.createElement("div");
          div.style.borderTop = "1px dashed var(--border)";
          div.style.paddingTop = "0.4rem";
          div.style.marginTop = "0.4rem";
          div.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:600;">${m.shop_name}</div>
              <span class="badge-status">${m.status}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Konum</span>
              <span class="stat-value">${m.city || "-"} ¬∑ ${m.country || "-"}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">ƒ∞leti≈üim</span>
              <span class="stat-value">${m.contact_name || "-"} ${m.phone ? " ¬∑ " + m.phone : ""}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">Coffee Star</span>
              <span class="stat-value">${m.wants_coffee_star ? "Evet" : "Hayƒ±r"}</span>
            </div>
            <div class="stat-row">
              <span class="stat-label">3. dalga uyumu</span>
              <span class="stat-value">${m.has_third_wave ? "Evet" : "Belki / Hayƒ±r"}</span>
            </div>
            ${m.notes ? '<div style="margin-top:0.25rem;font-size:0.75rem;color:var(--text-muted);">'+m.notes.replace(/</g,"&lt;")+'</div>' : ''}
            <div style="margin-top:0.25rem;font-size:0.7rem;color:var(--text-muted);">
              Kaydedildi: ${new Date(m.createdAt).toLocaleString("tr-TR")}
            </div>
          `;
          membershipList.appendChild(div);
        });
    }

    renderShops();
    renderMemberships();
  </script>
</body>
</html>
